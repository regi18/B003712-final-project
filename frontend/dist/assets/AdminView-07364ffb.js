import{_ as g,h as C,o as n,c as r,d as i,t as p,e as _,F as h,r as v,w as I,v as S,m as q,n as V,p as N,b as x,q as U,s as E,u as K,l as m,x as f,i as L}from"./main-435676fe.js";const A={name:"core-edit-list-item",emits:["cancel","save"],props:{template:{type:Object,required:!0},item:{type:Object,required:!0}},created(){var s;if(this.editItem=this.item,this.item&&this.template&&!((s=this.item)!=null&&s.isNew))for(const e of this.template)e.type==="file"&&delete this.editItem[e.key]},data(){return{editItem:null,loading:!1,errorMsg:null}},methods:{onInputChanged(s){var e;s==="title"&&((e=this.editItem)!=null&&e.isNew)&&(this.editItem.slug=this.editItem.title.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)+/g,""))},error(s){this.errorMsg=s,setTimeout(()=>this.errorMsg=null,3500)},onCancel(){this.$emit("cancel",null)},onSave(){var s;for(const e of this.template)if(e.required&&!this.editItem[e.key]&&!(!((s=this.item)!=null&&s.isNew)&&e.type==="file")){this.error("Please fill all required fields.");return}this.$emit("save",this.item)},readFile(s,e){var o;this.loading=!0;const d=(o=s==null?void 0:s.target)==null?void 0:o.files[0],u=new FileReader;u.addEventListener("load",l=>{var c;this.editItem[e]=(c=l.target)==null?void 0:c.result,this.loading=!1}),u.readAsDataURL(d)}}};const b=s=>(N("data-v-b493ddb1"),s=s(),x(),s),$={class:"core-crud-list core-edit-list-item"},B={class:"header"},T=["disabled"],D=b(()=>i("i",{class:"fas fa-arrow-left"},null,-1)),M=[D],F=b(()=>i("div",{class:"spacer"},null,-1)),O={key:0,class:"error"},z=["disabled"],P=b(()=>i("i",{class:"fas fa-save"},null,-1)),j=[P],J=["for"],R=["id","onUpdate:modelValue","onInput","disabled"],G=["id","onUpdate:modelValue"],H=["onUpdate:modelValue"],Q=["value"],W=["id","accept","onChange"];function X(s,e,d,u,o,l){const c=C("v-md-editor");return n(),r("div",$,[i("div",B,[i("button",{onClick:e[0]||(e[0]=t=>l.onCancel()),disabled:o.loading},M,8,T),F,o.errorMsg?(n(),r("p",O,p(o.errorMsg),1)):_("",!0),i("button",{onClick:e[1]||(e[1]=t=>l.onSave()),disabled:o.loading},j,8,z)]),i("main",null,[(n(!0),r(h,null,v(d.template,t=>{var y;return n(),r("div",{class:"field",key:t.key},[i("label",{for:t.key},p(t.title)+p(t.required?"*":""),9,J),t.type==="input"?I((n(),r("input",{key:0,type:"text",id:t.key,"onUpdate:modelValue":a=>o.editItem[t.key]=a,onInput:a=>l.onInputChanged(t.key),disabled:!((y=o.editItem)!=null&&y.isNew)&&(t.key==="slug"||t.key==="id")},null,40,R)),[[S,o.editItem[t.key]]]):_("",!0),t.type==="number"?I((n(),r("input",{key:1,type:"number",id:t.key,"onUpdate:modelValue":a=>o.editItem[t.key]=a},null,8,G)),[[S,o.editItem[t.key]]]):t.type==="textarea"?(n(),q(c,{key:2,modelValue:o.editItem[t.key],"onUpdate:modelValue":a=>o.editItem[t.key]=a,height:"400px"},null,8,["modelValue","onUpdate:modelValue"])):_("",!0),t.type==="select"?I((n(),r("select",{key:3,"onUpdate:modelValue":a=>o.editItem[t.key]=a},[(n(!0),r(h,null,v(t.options,a=>(n(),r("option",{key:a.key,value:a.key},p(a.title),9,Q))),128))],8,H)),[[V,o.editItem[t.key]]]):t.type==="file"?(n(),r("input",{key:4,type:"file",id:t.key,accept:t.mime,onChange:a=>l.readFile(a,t.key),class:"file-upload"},null,40,W)):_("",!0)])}),128))])])}const Y=g(A,[["render",X],["__scopeId","data-v-b493ddb1"]]),Z={name:"core-crud-list",components:{CoreEditListItem:Y},emits:["deleteItem","saveItem","error"],props:{items:{type:Array,required:!0},titleKey:{type:String,default:"title"},subtitleKey:{type:String,default:"subtitle"},editorTemplate:{type:Array,required:!0},apiBaseUrl:{type:String,required:!0}},data(){return{editItem:null}},methods:{addNew(){this.editItem={isNew:!0}},onEdit(s){this.editItem=JSON.parse(JSON.stringify(s))},async onDelete(s){if(confirm("Are you sure you want to delete this item?"))try{await U(this.apiBaseUrl+"/"+(s.slug??s.id)),this.$emit("deleteItem",s)}catch(e){this.$emit("error",e.errors)}},async onSave(s){try{s.isNew?await E(this.apiBaseUrl,s):await K(this.apiBaseUrl+"/"+(s.slug??s.id),s),this.$emit("saveItem",s),this.editItem=null}catch(e){this.$emit("error",e.errors)}}}};const ee={key:0,class:"core-crud-list"},te={class:"header"},se=i("i",{class:"fas fa-plus"},null,-1),ie=[se],oe={class:"left"},le={class:"title"},ne={class:"subtitle"},re={class:"right"},ae=["onClick"],de=i("i",{style:{color:"darkorange"},class:"fas fa-edit"},null,-1),ue=[de],ce=["onClick"],me=i("i",{style:{color:"red"},class:"fas fa-trash"},null,-1),pe=[me];function ye(s,e,d,u,o,l){const c=C("CoreEditListItem");return o.editItem?(n(),q(c,{key:1,item:o.editItem,onCancel:e[1]||(e[1]=t=>o.editItem=null),onSave:e[2]||(e[2]=t=>l.onSave(t)),template:d.editorTemplate},null,8,["item","template"])):(n(),r("div",ee,[i("div",te,[i("button",{onClick:e[0]||(e[0]=t=>l.addNew())},ie)]),i("main",null,[(n(!0),r(h,null,v(d.items,(t,y)=>(n(),r("div",{class:"list-item",key:y},[i("div",oe,[i("span",le,p(t[d.titleKey]),1),i("span",ne,p(t[d.subtitleKey]),1)]),i("div",re,[i("button",{onClick:a=>l.onEdit(t)},ue,8,ae),i("button",{onClick:a=>l.onDelete(t)},pe,8,ce)])]))),128))])]))}const _e=g(Z,[["render",ye]]),k={article:[{type:"input",title:"Slug",key:"slug",required:!0},{type:"input",title:"Title",key:"title",required:!0},{type:"select",key:"section",title:"Section",options:[],required:!0},{title:"Author",type:"input",key:"author",required:!0},{title:"Issue No.",type:"number",key:"issueNumber",required:!0},{title:"Content (markdown)",type:"textarea",key:"content",required:!0},{title:"Image",key:"img",type:"file",mime:"image/*"}],cartoon:[{type:"input",title:"Title",key:"title",required:!0},{title:"Image",type:"file",mime:"image/*",key:"img",required:!0}],paperIssue:[{type:"number",title:"Issue No.",key:"issueNumber",required:!0},{title:"Paper (pdf)",type:"file",mime:"application/pdf",key:"pdf",required:!0}],section:[{type:"input",title:"Title",key:"title",required:!0},{title:"Slug",type:"input",key:"slug",required:!0}]},he={name:"AdminView",components:{CoreCrudList:_e},created(){this.setSection("articles")},methods:{async setSection(s){if(this.section=s,this.items=[],this.section==="cartoons")this.template=k.cartoon,this.items=await m("cartoons"),this.titleKey="title";else if(this.section==="downloads")this.template=k.paperIssue,this.items=await m("downloads"),this.titleKey="issueNumber";else if(this.section==="sections")this.template=k.section,this.items=await m("sections"),this.titleKey="title";else if(this.section==="articles"){this.template=k.article;const e=await m("sections"),d=this.template.findIndex(u=>u.key==="section");this.template[d].options=e.map(u=>({key:u.slug,title:u.title})),this.items=await m("articles"),this.titleKey="title"}},async onSave(s){this.items=await m(this.section)},async onDelete(s){this.items=await m(this.section)},onError(s){this.errors=[];for(const e in s)if(Array.isArray(s[e]))for(const d of s[e])this.errors.push(e+": "+d);else this.errors.push(e+": "+s[e]);setTimeout(()=>{this.errors=null},5e3)}},data(){return{section:"articles",titleKey:"title",template:{},items:[],errors:null}}};const w=s=>(N("data-v-454ef00a"),s=s(),x(),s),fe=w(()=>i("h2",{style:{"padding-top":"0.4em"}},"Manage the gazette",-1)),ke={class:"container admin-container"},ve={class:"sidenav"},Ie={class:"content"},ge={key:0,class:"error-box"},Ce=w(()=>i("span",{class:"title"},"Errors",-1)),be=w(()=>i("i",{class:"fas fa-times btn"},null,-1)),we=[Ce,be];function Se(s,e,d,u,o,l){const c=C("CoreCrudList");return n(),r(h,null,[fe,i("div",ke,[i("div",ve,[i("ul",null,[i("li",{class:f(o.section==="articles"?"active":""),onClick:e[0]||(e[0]=t=>l.setSection("articles"))},"Articles",2),i("li",{class:f(o.section==="sections"?"active":""),onClick:e[1]||(e[1]=t=>l.setSection("sections"))},"Sections",2),i("li",{class:f(o.section==="cartoons"?"active":""),onClick:e[2]||(e[2]=t=>l.setSection("cartoons"))},"Cartoons",2),i("li",{class:f(o.section==="downloads"?"active":""),onClick:e[3]||(e[3]=t=>l.setSection("downloads"))},"Papers Issues",2)])]),i("div",Ie,[o.errors?(n(),r("div",ge,[i("div",{class:"header",onClick:e[4]||(e[4]=t=>o.errors=null)},we),i("ul",null,[(n(!0),r(h,null,v(o.errors,(t,y)=>(n(),r("li",{key:y},p(t),1))),128))])])):_("",!0),L(c,{editorTemplate:o.template,titleKey:o.titleKey,items:o.items,onSaveItem:e[5]||(e[5]=t=>l.onSave(t)),onDeleteItem:e[6]||(e[6]=t=>l.onDelete(t)),onError:e[7]||(e[7]=t=>l.onError(t)),apiBaseUrl:o.section},null,8,["editorTemplate","titleKey","items","apiBaseUrl"])])])],64)}const Ne=g(he,[["render",Se],["__scopeId","data-v-454ef00a"]]);export{Ne as default};
