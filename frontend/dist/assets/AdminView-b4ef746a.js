import{_ as I,g as C,o as l,c as r,d as o,t as y,e as _,F as h,r as v,w as g,v as S,h as q,j as U,p as N,b as V,l as L,m as E,n as K,i as p,q as f,k as $}from"./main-7264d4b6.js";const A={name:"core-edit-list-item",emits:["cancel","save"],props:{template:{type:Object,required:!0},item:{type:Object,required:!0}},created(){var t;if(this.editItem=this.item,this.item&&this.template&&!((t=this.item)!=null&&t.isNew))for(const e of this.template)e.type==="file"&&delete this.editItem[e.key]},data(){return{editItem:null,loading:!1,errorMsg:null}},methods:{onInputChanged(t){var e;t==="title"&&((e=this.editItem)!=null&&e.isNew)&&(this.editItem.slug=this.editItem.title.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)+/g,""))},error(t){this.errorMsg=t,setTimeout(()=>this.errorMsg=null,3500)},onCancel(){this.$emit("cancel",null)},onSave(){var t;for(const e of this.template)if(e.required&&!this.editItem[e.key]&&!(!((t=this.item)!=null&&t.isNew)&&e.type==="file")){this.error("Please fill all required fields.");return}this.$emit("save",this.item)},readFile(t,e){var s;this.loading=!0;const d=(s=t==null?void 0:t.target)==null?void 0:s.files[0],u=new FileReader;u.addEventListener("load",n=>{var m;this.editItem[e]=(m=n.target)==null?void 0:m.result,this.loading=!1}),u.readAsDataURL(d)}}};const b=t=>(N("data-v-b493ddb1"),t=t(),V(),t),B={class:"core-crud-list core-edit-list-item"},T={class:"header"},D=["disabled"],M=b(()=>o("i",{class:"fas fa-arrow-left"},null,-1)),F=[M],O=b(()=>o("div",{class:"spacer"},null,-1)),j={key:0,class:"error"},z=["disabled"],P=b(()=>o("i",{class:"fas fa-save"},null,-1)),J=[P],R=["for"],G=["id","onUpdate:modelValue","onInput","disabled"],H=["id","onUpdate:modelValue"],Q=["onUpdate:modelValue"],W=["value"],X=["id","accept","onChange"];function Y(t,e,d,u,s,n){const m=C("v-md-editor");return l(),r("div",B,[o("div",T,[o("button",{onClick:e[0]||(e[0]=i=>n.onCancel()),disabled:s.loading},F,8,D),O,s.errorMsg?(l(),r("p",j,y(s.errorMsg),1)):_("",!0),o("button",{onClick:e[1]||(e[1]=i=>n.onSave()),disabled:s.loading},J,8,z)]),o("main",null,[(l(!0),r(h,null,v(d.template,i=>{var c;return l(),r("div",{class:"field",key:i.key},[o("label",{for:i.key},y(i.title)+y(i.required?"*":""),9,R),i.type==="input"?g((l(),r("input",{key:0,type:"text",id:i.key,"onUpdate:modelValue":a=>s.editItem[i.key]=a,onInput:a=>n.onInputChanged(i.key),disabled:!((c=s.editItem)!=null&&c.isNew)&&(i.key==="slug"||i.key==="id")},null,40,G)),[[S,s.editItem[i.key]]]):_("",!0),i.type==="number"?g((l(),r("input",{key:1,type:"number",id:i.key,"onUpdate:modelValue":a=>s.editItem[i.key]=a},null,8,H)),[[S,s.editItem[i.key]]]):i.type==="textarea"?(l(),q(m,{key:2,modelValue:s.editItem[i.key],"onUpdate:modelValue":a=>s.editItem[i.key]=a,height:"400px"},null,8,["modelValue","onUpdate:modelValue"])):_("",!0),i.type==="select"?g((l(),r("select",{key:3,"onUpdate:modelValue":a=>s.editItem[i.key]=a},[(l(!0),r(h,null,v(i.options,a=>(l(),r("option",{key:a.key,value:a.key},y(a.title),9,W))),128))],8,Q)),[[U,s.editItem[i.key]]]):i.type==="file"?(l(),r("input",{key:4,type:"file",id:i.key,accept:i.mime,onChange:a=>n.readFile(a,i.key),class:"file-upload"},null,40,X)):_("",!0)])}),128))])])}const Z=I(A,[["render",Y],["__scopeId","data-v-b493ddb1"]]),ee={name:"core-crud-list",components:{CoreEditListItem:Z},emits:["deleteItem","saveItem","error"],props:{items:{type:Array,required:!0},titleKey:{type:String,default:"title"},subtitleKey:{type:String,default:"subtitle"},editorTemplate:{type:Array,required:!0},apiBaseUrl:{type:String,required:!0}},data(){return{editItem:null}},methods:{addNew(){this.editItem={isNew:!0}},onEdit(t){this.editItem=JSON.parse(JSON.stringify(t))},async onDelete(t){if(confirm("Are you sure you want to delete this item?"))try{await L(this.apiBaseUrl+"/"+(t.slug??t.id)),this.$emit("deleteItem",t)}catch(e){this.$emit("error",e.errors)}},async onSave(t){try{t.isNew?await E(this.apiBaseUrl,t):await K(this.apiBaseUrl+"/"+(t.slug??t.id),t),this.$emit("saveItem",t),this.editItem=null}catch(e){this.$emit("error",e.errors)}}}};const te={key:0,class:"core-crud-list"},ie={class:"header"},se=o("i",{class:"fas fa-plus"},null,-1),oe=[se],le={key:0},ne={class:"left"},re={class:"title"},ae={class:"subtitle"},de={class:"right"},ce=["onClick"],ue=o("i",{style:{color:"darkorange"},class:"fas fa-edit"},null,-1),me=[ue],pe=["onClick"],ye=o("i",{style:{color:"red"},class:"fas fa-trash"},null,-1),_e=[ye],he={key:1,style:{padding:"1em"}};function fe(t,e,d,u,s,n){var i;const m=C("CoreEditListItem");return s.editItem?(l(),q(m,{key:1,item:s.editItem,onCancel:e[1]||(e[1]=c=>s.editItem=null),onSave:e[2]||(e[2]=c=>n.onSave(c)),template:d.editorTemplate},null,8,["item","template"])):(l(),r("div",te,[o("div",ie,[o("button",{onClick:e[0]||(e[0]=c=>n.addNew())},oe)]),((i=d.items)==null?void 0:i.length)>0?(l(),r("main",le,[(l(!0),r(h,null,v(d.items,(c,a)=>(l(),r("div",{class:"list-item",key:a},[o("div",ne,[o("span",re,y(c[d.titleKey]),1),o("span",ae,y(c[d.subtitleKey]),1)]),o("div",de,[o("button",{onClick:x=>n.onEdit(c)},me,8,ce),o("button",{onClick:x=>n.onDelete(c)},_e,8,pe)])]))),128))])):(l(),r("main",he," Loading... "))]))}const ke=I(ee,[["render",fe]]),k={article:[{type:"input",title:"Slug",key:"slug",required:!0},{type:"input",title:"Title",key:"title",required:!0},{type:"select",key:"section",title:"Section",options:[],required:!0},{title:"Author",type:"input",key:"author",required:!0},{title:"Issue No.",type:"number",key:"issueNumber",required:!0},{title:"Content (markdown)",type:"textarea",key:"content",required:!0},{title:"Image",key:"img",type:"file",mime:"image/*"}],cartoon:[{type:"input",title:"Title",key:"title",required:!0},{title:"Image",type:"file",mime:"image/*",key:"img",required:!0}],paperIssue:[{type:"number",title:"Issue No.",key:"issueNumber",required:!0},{title:"Paper (pdf)",type:"file",mime:"application/pdf",key:"pdf",required:!0}],section:[{type:"input",title:"Title",key:"title",required:!0},{title:"Slug",type:"input",key:"slug",required:!0}]},ve={name:"AdminView",components:{CoreCrudList:ke},created(){this.setSection("articles")},methods:{async setSection(t){if(this.section=t,this.items=[],this.section==="cartoons")this.template=k.cartoon,this.items=await p("cartoons"),this.titleKey="title";else if(this.section==="downloads")this.template=k.paperIssue,this.items=await p("downloads"),this.titleKey="issueNumber";else if(this.section==="sections")this.template=k.section,this.items=await p("sections"),this.titleKey="title";else if(this.section==="articles"){this.template=k.article;const e=await p("sections"),d=this.template.findIndex(u=>u.key==="section");this.template[d].options=e.map(u=>({key:u.slug,title:u.title})),this.items=await p("articles"),this.titleKey="title"}},async onSave(t){this.items=await p(this.section)},async onDelete(t){this.items=await p(this.section)},onError(t){this.errors=[];for(const e in t)if(Array.isArray(t[e]))for(const d of t[e])this.errors.push(e+": "+d);else this.errors.push(e+": "+t[e]);setTimeout(()=>{this.errors=null},5e3)}},data(){return{section:"articles",titleKey:"title",template:{},items:[],errors:null}}};const w=t=>(N("data-v-454ef00a"),t=t(),V(),t),ge=w(()=>o("h2",{style:{"padding-top":"0.4em"}},"Manage the gazette",-1)),Ie={class:"container admin-container"},Ce={class:"sidenav"},be={class:"content"},we={key:0,class:"error-box"},Se=w(()=>o("span",{class:"title"},"Errors",-1)),qe=w(()=>o("i",{class:"fas fa-times btn"},null,-1)),Ne=[Se,qe];function Ve(t,e,d,u,s,n){const m=C("CoreCrudList");return l(),r(h,null,[ge,o("div",Ie,[o("div",Ce,[o("ul",null,[o("li",{class:f(s.section==="articles"?"active":""),onClick:e[0]||(e[0]=i=>n.setSection("articles"))},"Articles",2),o("li",{class:f(s.section==="sections"?"active":""),onClick:e[1]||(e[1]=i=>n.setSection("sections"))},"Sections",2),o("li",{class:f(s.section==="cartoons"?"active":""),onClick:e[2]||(e[2]=i=>n.setSection("cartoons"))},"Cartoons",2),o("li",{class:f(s.section==="downloads"?"active":""),onClick:e[3]||(e[3]=i=>n.setSection("downloads"))},"Papers Issues",2)])]),o("div",be,[s.errors?(l(),r("div",we,[o("div",{class:"header",onClick:e[4]||(e[4]=i=>s.errors=null)},Ne),o("ul",null,[(l(!0),r(h,null,v(s.errors,(i,c)=>(l(),r("li",{key:c},y(i),1))),128))])])):_("",!0),$(m,{editorTemplate:s.template,titleKey:s.titleKey,items:s.items,onSaveItem:e[5]||(e[5]=i=>n.onSave(i)),onDeleteItem:e[6]||(e[6]=i=>n.onDelete(i)),onError:e[7]||(e[7]=i=>n.onError(i)),apiBaseUrl:s.section},null,8,["editorTemplate","titleKey","items","apiBaseUrl"])])])],64)}const Ue=I(ve,[["render",Ve],["__scopeId","data-v-454ef00a"]]);export{Ue as default};
